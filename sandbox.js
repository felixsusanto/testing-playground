var me=Object.defineProperty;var we=(t,e,n)=>e in t?me(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n;var m=(t,e,n)=>(we(t,typeof e!="symbol"?e+"":e,n),n);import{d as b,t as ve,a as ye,j as z,r as Ee}from"./assets/event-map-55bf1d4b.js";import{m as _e,S as be,g as Le,c as xe,p as oe}from"./assets/parser-38b1132c.js";import{a as Ie}from"./assets/_commonjsHelpers-042e6b4d.js";import"./assets/beautify-0b9ec5a7.js";var $={},V={},Me;function L(){}L.prototype=Object.create(null);function u(){u.init.call(this)}u.EventEmitter=u;u.usingDomains=!1;u.prototype.domain=void 0;u.prototype._events=void 0;u.prototype._maxListeners=void 0;u.defaultMaxListeners=10;u.init=function(){this.domain=null,u.usingDomains&&Me.active,(!this._events||this._events===Object.getPrototypeOf(this)._events)&&(this._events=new L,this._eventsCount=0),this._maxListeners=this._maxListeners||void 0};u.prototype.setMaxListeners=function(e){if(typeof e!="number"||e<0||isNaN(e))throw new TypeError('"n" argument must be a positive number');return this._maxListeners=e,this};function se(t){return t._maxListeners===void 0?u.defaultMaxListeners:t._maxListeners}u.prototype.getMaxListeners=function(){return se(this)};function Ne(t,e,n){if(e)t.call(n);else for(var r=t.length,i=D(t,r),s=0;s<r;++s)i[s].call(n)}function Se(t,e,n,r){if(e)t.call(n,r);else for(var i=t.length,s=D(t,i),o=0;o<i;++o)s[o].call(n,r)}function Te(t,e,n,r,i){if(e)t.call(n,r,i);else for(var s=t.length,o=D(t,s),l=0;l<s;++l)o[l].call(n,r,i)}function Ce(t,e,n,r,i,s){if(e)t.call(n,r,i,s);else for(var o=t.length,l=D(t,o),d=0;d<o;++d)l[d].call(n,r,i,s)}function Oe(t,e,n,r){if(e)t.apply(n,r);else for(var i=t.length,s=D(t,i),o=0;o<i;++o)s[o].apply(n,r)}u.prototype.emit=function(e){var n,r,i,s,o,l,d,f=e==="error";if(l=this._events,l)f=f&&l.error==null;else if(!f)return!1;if(d=this.domain,f){if(n=arguments[1],d)n||(n=new Error('Uncaught, unspecified "error" event')),n.domainEmitter=this,n.domain=d,n.domainThrown=!1,d.emit("error",n);else{if(n instanceof Error)throw n;var y=new Error('Uncaught, unspecified "error" event. ('+n+")");throw y.context=n,y}return!1}if(r=l[e],!r)return!1;var g=typeof r=="function";switch(i=arguments.length,i){case 1:Ne(r,g,this);break;case 2:Se(r,g,this,arguments[1]);break;case 3:Te(r,g,this,arguments[1],arguments[2]);break;case 4:Ce(r,g,this,arguments[1],arguments[2],arguments[3]);break;default:for(s=new Array(i-1),o=1;o<i;o++)s[o-1]=arguments[o];Oe(r,g,this,s)}return!0};function ae(t,e,n,r){var i,s,o;if(typeof n!="function")throw new TypeError('"listener" argument must be a function');if(s=t._events,s?(s.newListener&&(t.emit("newListener",e,n.listener?n.listener:n),s=t._events),o=s[e]):(s=t._events=new L,t._eventsCount=0),!o)o=s[e]=n,++t._eventsCount;else if(typeof o=="function"?o=s[e]=r?[n,o]:[o,n]:r?o.unshift(n):o.push(n),!o.warned&&(i=se(t),i&&i>0&&o.length>i)){o.warned=!0;var l=new Error("Possible EventEmitter memory leak detected. "+o.length+" "+e+" listeners added. Use emitter.setMaxListeners() to increase limit");l.name="MaxListenersExceededWarning",l.emitter=t,l.type=e,l.count=o.length,De(l)}return t}function De(t){typeof console.warn=="function"?console.warn(t):console.log(t)}u.prototype.addListener=function(e,n){return ae(this,e,n,!1)};u.prototype.on=u.prototype.addListener;u.prototype.prependListener=function(e,n){return ae(this,e,n,!0)};function ce(t,e,n){var r=!1;function i(){t.removeListener(e,i),r||(r=!0,n.apply(t,arguments))}return i.listener=n,i}u.prototype.once=function(e,n){if(typeof n!="function")throw new TypeError('"listener" argument must be a function');return this.on(e,ce(this,e,n)),this};u.prototype.prependOnceListener=function(e,n){if(typeof n!="function")throw new TypeError('"listener" argument must be a function');return this.prependListener(e,ce(this,e,n)),this};u.prototype.removeListener=function(e,n){var r,i,s,o,l;if(typeof n!="function")throw new TypeError('"listener" argument must be a function');if(i=this._events,!i)return this;if(r=i[e],!r)return this;if(r===n||r.listener&&r.listener===n)--this._eventsCount===0?this._events=new L:(delete i[e],i.removeListener&&this.emit("removeListener",e,r.listener||n));else if(typeof r!="function"){for(s=-1,o=r.length;o-- >0;)if(r[o]===n||r[o].listener&&r[o].listener===n){l=r[o].listener,s=o;break}if(s<0)return this;if(r.length===1){if(r[0]=void 0,--this._eventsCount===0)return this._events=new L,this;delete i[e]}else ke(r,s);i.removeListener&&this.emit("removeListener",e,l||n)}return this};u.prototype.removeAllListeners=function(e){var n,r;if(r=this._events,!r)return this;if(!r.removeListener)return arguments.length===0?(this._events=new L,this._eventsCount=0):r[e]&&(--this._eventsCount===0?this._events=new L:delete r[e]),this;if(arguments.length===0){for(var i=Object.keys(r),s=0,o;s<i.length;++s)o=i[s],o!=="removeListener"&&this.removeAllListeners(o);return this.removeAllListeners("removeListener"),this._events=new L,this._eventsCount=0,this}if(n=r[e],typeof n=="function")this.removeListener(e,n);else if(n)do this.removeListener(e,n[n.length-1]);while(n[0]);return this};u.prototype.listeners=function(e){var n,r,i=this._events;return i?(n=i[e],n?typeof n=="function"?r=[n.listener||n]:r=We(n):r=[]):r=[],r};u.listenerCount=function(t,e){return typeof t.listenerCount=="function"?t.listenerCount(e):le.call(t,e)};u.prototype.listenerCount=le;function le(t){var e=this._events;if(e){var n=e[t];if(typeof n=="function")return 1;if(n)return n.length}return 0}u.prototype.eventNames=function(){return this._eventsCount>0?Reflect.ownKeys(this._events):[]};function ke(t,e){for(var n=e,r=n+1,i=t.length;r<i;n+=1,r+=1)t[n]=t[r];t.pop()}function D(t,e){for(var n=new Array(e);e--;)n[e]=t[e];return n}function We(t){for(var e=new Array(t.length),n=0;n<e.length;++n)e[n]=t[n].listener||t[n];return e}const Be=Object.freeze(Object.defineProperty({__proto__:null,EventEmitter:u,default:u},Symbol.toStringTag,{value:"Module"})),de=Ie(Be);var j={},k={};Object.defineProperty(k,"__esModule",{value:!0});class Pe{constructor(e){this._name=e}get name(){return this._name}get path(){return console.warn("'sender.path' is now deprecated, since it no longer supports iframes. Use 'sender.name' instead"),this._name}isInternal(){return this.isInternalImpl(!1)}isReallyInternal(){return console.warn("'sender.isReallyInternal()' is now deprecated, since it no longer supports iframes. Use 'sender.isInternal()' instead"),this.isInternalImpl(!0)}toString(){return this._name}isInternalImpl(e){return!e&&this._name.indexOf("devtools")===0?!0:!/window|frame/.test(this._name)}}k.Endpoint=Pe;var G={};Object.defineProperty(G,"__esModule",{value:!0});function Ae(){return"oooooo".replace(/[o]/g,t=>(t^crypto.getRandomValues(new Uint8Array(1))[0]&15>>t/4).toString(16))}G.uuid=Ae;var Re=function(t){return typeof t=="object"?pe(t,[]):typeof t=="function"?"[Function: "+(t.name||"anonymous")+"]":t};function pe(t,e){var n;return Array.isArray(t)?n=[]:n={},e.push(t),Object.keys(t).forEach(function(r){var i=t[r];if(typeof i!="function"){if(!i||typeof i!="object"){n[r]=i;return}if(e.indexOf(t[r])===-1){n[r]=pe(t[r],e.slice(0));return}n[r]="[Circular]"}}),typeof t.name=="string"&&(n.name=t.name),typeof t.message=="string"&&(n.message=t.message),typeof t.stack=="string"&&(n.stack=t.stack),n}Object.defineProperty(j,"__esModule",{value:!0});const Z=k,ee=G,$e=Re;var h;(function(t){t[t.Window=0]="Window",t[t.Frame=1]="Frame",t[t.Devtools=2]="Devtools",t[t.Background=3]="Background",t[t.ContentScript=4]="ContentScript",t[t.Worker=5]="Worker"})(h||(h={}));const O=/^((?:background$)|devtools|content-script|window)(?:@(\d+))?$/,U=t=>typeof chrome<"u"&&chrome[t];class a{static sendMessage(e,n,r){let i=r instanceof Z.Endpoint?r.name:r;const s="Bridge#sendMessage ->";if(!O.test(i))throw new TypeError(`${s} Destination must be any one of known destinations`);if(this.context===h.Background){const[o,l,d]=i.match(O);if(l!=="background"&&!d||!parseInt(d,10))throw new TypeError(`${s} When sending messages from background page, use @tabId syntax to target specific tab`)}return new Promise((o,l)=>{const d={messageID:e,data:n,destination:i,messageType:"message",transactionId:ee.uuid(),origin:this.ctxname,hops:[],timestamp:Date.now()};this.openTransactions.set(d.transactionId,{resolve:o,reject:l}),this.routeMessage(d)})}static onMessage(e,n){this.onMessageListeners.set(e,n)}static init(){if(!this.isInitialized){if(this.context===null)throw new Error("Unable to detect runtime context i.e crx-bridge can't figure out what to do");if(this.id=ee.uuid(),this.ctxname=h[this.context].toLowerCase(),(this.context===h.Window||this.context===h.ContentScript)&&window.addEventListener("message",this.handleWindowOnMessage),this.context===h.ContentScript&&(this.ctxname="content-script"),this.context===h.Devtools){const n=`devtools@${chrome.devtools.inspectedWindow.tabId}`;this.ctxname=n,this.port=chrome.runtime.connect({name:n}),this.port.onMessage.addListener(r=>{this.routeMessage(r)}),this.port.onDisconnect.addListener(()=>{this.port=null})}this.context===h.Background&&chrome.runtime.onConnect.addListener(e=>{const n=e.name!==""?e.name:`content-script@${e.sender.tab.id}`;this.portMap.set(n,e),this.messageQueue.forEach(r=>{r.resolvedNextNode===n&&(e.postMessage(r.message),this.messageQueue.delete(r))}),e.onDisconnect.addListener(()=>{this.portMap.delete(n)}),e.onMessage.addListener(r=>{this.routeMessage(r,{sourcePort:e})})}),this.context===h.ContentScript&&top===window&&(this.port=chrome.runtime.connect(),this.port.onMessage.addListener(e=>{this.routeMessage(e)})),this.isInitialized=!0}}static async handleInboundMessage(e){const{transactionId:n,messageID:r,messageType:i}=e;if(i==="reply"){const s=a.openTransactions.get(n);if(s){const{err:o,data:l}=e;if(o){const d=new(typeof self[o.name]=="function"?self[o.name]:Error)(o.message);for(let f in o)d[f]=o[f];s.reject(d)}else s.resolve(l);a.openTransactions.delete(n)}}else if(i==="message"){let s,o,l=!1;try{const d=a.onMessageListeners.get(r);if(typeof d=="function")s=await d({sender:new Z.Endpoint(e.origin),id:r,data:e.data,timestamp:e.timestamp});else throw l=!0,new Error(`[crx-bridge] No handler registered in '${a.ctxname}' to accept messages with id '${r}'`)}catch(d){o=d}finally{if(o&&(e.err=$e(o)),a.routeMessage({...e,messageType:"reply",data:s,origin:a.ctxname,destination:e.origin,hops:[]}),o&&!l)throw s}}}static winRouteMsg(e,n){a.ensureNamespace();const r=new MessageChannel,i=setTimeout(()=>{r.port1.onmessage=null,a.winRouteMsg(e,n)},300);r.port1.onmessage=s=>{clearTimeout(i),e.postMessage({cmd:"__crx_bridge_route_message",scope:a.namespace,payload:n,context:a.context},"*")},e.postMessage({cmd:"__crx_bridge_verify_listening",scope:a.namespace,context:a.context},"*",[r.port2])}}a.ctxname=null;a.id=null;a.context=U("devtools")?h.Devtools:U("tabs")?h.Background:U("extension")?h.ContentScript:typeof document>"u"&&typeof importScripts=="function"?h.Worker:typeof document<"u"&&window.top!==window?h.Frame:typeof document<"u"?h.Window:null;a.isExternalMessagingEnabled=!1;a.linkedNodesCache={};a.isInitialized=!1;a.openTransactions=new Map;a.onMessageListeners=new Map;a.port=null;a.portMap=new Map;a.messageQueue=new Set;a.setNamespace=t=>{a.namespace=t};a.allowWindowMessaging=t=>{a.isWindowMessagingAllowed=!0,a.namespace=t};a.handleWindowOnMessage=async t=>{if(a.context===h.ContentScript&&!a.isWindowMessagingAllowed)return;const{data:e,source:n,ports:r}=t;if(e.cmd==="__crx_bridge_verify_listening"&&e.scope===a.namespace&&e.context!==a.context){r[0].postMessage(!0);return}else e.cmd==="__crx_bridge_route_message"&&e.scope===a.namespace&&e.context!==a.context&&(a.context===h.ContentScript&&(e.payload.origin="window"),a.routeMessage(e.payload))};a.routeMessage=async(t,e={})=>{const{origin:n,messageID:r,transactionId:i,destination:s}=t;if(!(t.hops.indexOf(a.id)>-1)&&(t.hops.push(a.id),!(a.context===h.ContentScript&&/window/.test(t.destination+n)&&!a.allowWindowMessaging)&&(s||a.handleInboundMessage(t),O.test(s)))){if(a.context===h.Frame)throw new Error("crx-bridge no longer supports iframes due to too much complexity and not so many use cases");if(a.context===h.Window)a.winRouteMsg(window,t);else if(a.context===h.ContentScript&&s==="window")t.destination=null,a.winRouteMsg(window,t);else if(a.context===h.Devtools||a.context===h.ContentScript)/background/.test(s)&&(t.destination=null),a.port.postMessage(t);else if(a.context===h.Background&&e.sourcePort){const[o,l,d]=s.match(O),[f,y,g=`${e.sourcePort.sender.tab.id}`]=n.match(O);/content-script|window/.test(y)&&(t.origin=`${y}@${g}`);const v=d?o:`${o}@${g}`;l!=="window"?t.destination=null:t.destination="window";const x=l==="window"?v.replace("window","content-script"):v,E=a.portMap.get(x);E?E.postMessage(t):a.messageQueue.add({resolvedNextNode:x,message:t})}}};a.ensureNamespace=()=>{if(typeof a.namespace!="string"||a.namespace.length===0){const t=`crx-bridge uses window.postMessage to talk with other "window"(s), for message routing and stuff, which is global/conflicting operation in case there are other scripts using crx-bridge. Call Bridge#setNamespace(nsps) to isolate your app. Example: Bridge.setNamespace('com.facebook.react-devtools'). Make sure to use same namespace across all your scripts whereever window.postMessage is likely to be used`;throw new Error(t)}};j.Bridge=a;a.init();var H={};Object.defineProperty(H,"__esModule",{value:!0});const je=de,q=j,Ge=k;class _{constructor(e){this.handleStreamClose=()=>{this.isClosed||(this.isClosed=!0,this.emitter.emit("closed",!0),this.emitter.removeAllListeners())},typeof e.endpoint=="string"&&(e.endpoint=new Ge.Endpoint(e.endpoint)),this.internalInfo=e,this.emitter=new je.EventEmitter,this.isClosed=!1,_.initDone||(q.Bridge.onMessage("__crx_bridge_stream_transfer__",n=>{const{streamId:r,streamTransfer:i,action:s}=n.data,o=_.openStreams.get(r);o&&!o.isClosed&&(s==="transfer"&&o.emitter.emit("message",i),s==="close"&&(_.openStreams.delete(r),o.handleStreamClose()))}),_.initDone=!0),_.openStreams.set(e.streamId,this)}get info(){return this.internalInfo}send(e){if(this.isClosed)throw new Error("Attempting to send a message over closed stream. Use stream.onClose(<callback>) to keep an eye on stream status");q.Bridge.sendMessage("__crx_bridge_stream_transfer__",{streamId:this.internalInfo.streamId,streamTransfer:e,action:"transfer"},this.internalInfo.endpoint)}close(e){e&&this.send(e),this.handleStreamClose(),q.Bridge.sendMessage("__crx_bridge_stream_transfer__",{streamId:this.internalInfo.streamId,streamTransfer:null,action:"close"},this.internalInfo.endpoint)}onMessage(e){return this.getDisposable("message",e)}onClose(e){return this.getDisposable("closed",e)}getDisposable(e,n){this.emitter.on(e,n);const r=()=>{this.emitter.removeListener(e,n)};return Object.assign(r,{dispose:r,close:r})}}_.initDone=!1;_.openStreams=new Map;H.Stream=_;Object.defineProperty(V,"__esModule",{value:!0});const He=de,Fe=j,te=H,Ue=G;class W extends Fe.Bridge{static init(){super.init(),this.onMessage("__crx_bridge_stream_open__",e=>new Promise(n=>{const{sender:r,data:i}=e,{channel:s}=i;let o=!1;const l=()=>{const d=this.onOpenStreamCallbacks.get(s);typeof d=="function"?(d(new te.Stream({...i,endpoint:r})),o&&this.streamyEmitter.removeListener("did-change-stream-callbacks",l),n(!0)):o||(o=!0,this.streamyEmitter.on("did-change-stream-callbacks",l))};l()}))}static onOpenStreamChannel(e,n){if(this.onOpenStreamCallbacks.has(e))throw new Error("crx-bridge: This channel has already been claimed. Stream allows only one-on-one communication");this.onOpenStreamCallbacks.set(e,n),this.streamyEmitter.emit("did-change-stream-callbacks")}static async openStream(e,n){if(this.openStreams.has(e))throw new Error("crx-bridge: A Stream is already open at this channel");const r={streamId:Ue.uuid(),channel:e,endpoint:n},i=new te.Stream(r);return i.onClose(()=>{this.openStreams.delete(e)}),await this.sendMessage("__crx_bridge_stream_open__",r,n),this.openStreams.set(e,i),i}}W.openStreams=new Map;W.onOpenStreamCallbacks=new Map;W.streamyEmitter=new He.EventEmitter;V.BridgePlus=W;W.init();Object.defineProperty($,"__esModule",{value:!0});const qe=V;var Ye=H;$.Stream=Ye.Stream;var ze=k;$.Endpoint=ze.Endpoint;var M=$.default=qe.BridgePlus;function ue(t){var e;return((e=t.ownerDocument)==null?void 0:e.defaultView)||null}function ne(t){var e;return((e=ue(t))==null?void 0:e.frameElement)||null}function Ve(t){const e=fe(t);return he([t.getBoundingClientRect(),{top:e.borderTop,left:e.borderLeft,bottom:e.borderBottom,right:e.borderRight,width:0,height:0}])}function he(t){return t.reduce((e,n)=>e==null?n:{top:e.top+n.top,left:e.left+n.left,width:e.width,height:e.height,bottom:e.bottom+n.bottom,right:e.right+n.right})}function re(t,e){const n=ne(t);if(n&&n.contentWindow!==e){const r=[t.getBoundingClientRect()];let i=n,s=!1;for(;i;){const o=Ve(i);if(r.push(o),i=ne(i),s)break;i&&ue(i)===e&&(s=!0)}return he(r)}else return t.getBoundingClientRect()}function fe(t){const e=window.getComputedStyle(t);return{borderLeft:parseInt(e.borderLeftWidth,10),borderRight:parseInt(e.borderRightWidth,10),borderTop:parseInt(e.borderTopWidth,10),borderBottom:parseInt(e.borderBottomWidth,10),marginLeft:parseInt(e.marginLeft,10),marginRight:parseInt(e.marginRight,10),marginTop:parseInt(e.marginTop,10),marginBottom:parseInt(e.marginBottom,10),paddingLeft:parseInt(e.paddingLeft,10),paddingRight:parseInt(e.paddingRight,10),paddingTop:parseInt(e.paddingTop,10),paddingBottom:parseInt(e.paddingBottom,10)}}class Qe{constructor(e,n){m(this,"node");m(this,"border");m(this,"padding");m(this,"content");this.node=e.createElement("div"),this.border=e.createElement("div"),this.padding=e.createElement("div"),this.content=e.createElement("div"),this.border.style.borderColor=B.border,this.padding.style.borderColor=B.padding,this.content.style.backgroundColor=B.background,b(this.node.style,{borderColor:B.margin,pointerEvents:"none",position:"fixed"}),this.node.style.zIndex="10000000",this.node.appendChild(this.border),this.border.appendChild(this.padding),this.padding.appendChild(this.content),n.appendChild(this.node)}remove(){this.node.parentNode&&this.node.parentNode.removeChild(this.node)}update(e,n){Y(n,"margin",this.node),Y(n,"border",this.border),Y(n,"padding",this.padding),b(this.content.style,{height:e.height-n.borderTop-n.borderBottom-n.paddingTop-n.paddingBottom+"px",width:e.width-n.borderLeft-n.borderRight-n.paddingLeft-n.paddingRight+"px"}),b(this.node.style,{top:e.top-n.marginTop+"px",left:e.left-n.marginLeft+"px"})}}class Xe{constructor(e,n){m(this,"tip");m(this,"nameSpan");m(this,"dimSpan");this.tip=e.createElement("div"),b(this.tip.style,{display:"none",flexFlow:"row nowrap",backgroundColor:"#333740",borderRadius:"2px",fontFamily:'"SFMono-Regular", Consolas, "Liberation Mono", Menlo, Courier, monospace',fontWeight:"bold",padding:"3px 5px",pointerEvents:"none",position:"fixed",fontSize:"12px",whiteSpace:"nowrap"}),this.nameSpan=e.createElement("span"),this.tip.appendChild(this.nameSpan),b(this.nameSpan.style,{color:"#ee78e6",borderRight:"1px solid #aaaaaa",paddingRight:"0.5rem",marginRight:"0.5rem"}),this.dimSpan=e.createElement("span"),this.tip.appendChild(this.dimSpan),b(this.dimSpan.style,{color:"#d7d7d7"}),this.tip.style.zIndex="10000000",n.appendChild(this.tip)}remove(){this.tip.parentNode&&this.tip.parentNode.removeChild(this.tip)}updateContent(e){this.nameSpan.textContent=e.name,this.dimSpan.textContent=Math.round(e.width)+"px Ã— "+Math.round(e.height)+"px"}updatePosition(e,n){const r=this.tip.getBoundingClientRect(),i=Je(e,n,{width:r.width,height:r.height});b(this.tip.style,i.style)}}class Ke{constructor(){m(this,"window");m(this,"tipBoundsWindow");m(this,"container");m(this,"tip");m(this,"rects");const e=window.__TESTING_PLAYGROUND_TARGET_WINDOW__||window;this.window=e;const n=window.__TESTING_PLAYGROUND_TARGET_WINDOW__||window;this.tipBoundsWindow=n;const r=e.document;this.container=r.createElement("div"),this.container.style.zIndex="10000000",this.tip=new Xe(r,this.container),this.rects=[],r.body.appendChild(this.container)}remove(){this.tip.remove(),this.rects.forEach(e=>{e.remove()}),this.rects.length=0,this.container.parentNode&&this.container.parentNode.removeChild(this.container)}inspect(e){const n=e.filter(f=>f.nodeType===Node.ELEMENT_NODE);for(;this.rects.length>n.length;)this.rects.pop().remove();if(n.length===0)return;for(;this.rects.length<n.length;)this.rects.push(new Qe(this.window.document,this.container));const r={top:Number.POSITIVE_INFINITY,right:Number.NEGATIVE_INFINITY,bottom:Number.NEGATIVE_INFINITY,left:Number.POSITIVE_INFINITY};n.forEach((f,y)=>{const g=re(f,this.window),v=fe(f);r.top=Math.min(r.top,g.top-v.marginTop),r.right=Math.max(r.right,g.left+g.width+v.marginRight),r.bottom=Math.max(r.bottom,g.top+g.height+v.marginBottom),r.left=Math.min(r.left,g.left-v.marginLeft),this.rects[y].update(g,v)});const i=n[0].nodeName.toLowerCase(),s=n[0],o=s.ownerDocument.defaultView.__TESTING_PLAYGROUND__||{};let l={target:s,name:i,...r,width:r.right-r.left,height:r.top-r.bottom};typeof o.getElementTooltipData=="function"&&(l=o.getElementTooltipData(l)),this.tip.updateContent(l);const d=re(this.tipBoundsWindow.document.documentElement,this.window);this.tip.updatePosition({top:r.top,left:r.left,height:r.bottom-r.top,width:r.right-r.left},{top:d.top+this.tipBoundsWindow.scrollY,left:d.left+this.tipBoundsWindow.scrollX,height:this.tipBoundsWindow.innerHeight,width:this.tipBoundsWindow.innerWidth})}}function Je(t,e,n){const r=Math.max(n.height,20),i=Math.max(n.width,60),s=5;let o;t.top+t.height+r<=e.top+e.height?t.top+t.height<e.top+0?o=e.top+s:o=t.top+t.height+s:t.top-r<=e.top+e.height?t.top-r-s<e.top+s?o=e.top+s:o=t.top-r-s:o=e.top+e.height-r-s;let l=t.left+s;return t.left<e.left&&(l=e.left+s),t.left+i>e.left+e.width&&(l=e.left+e.width-i-s),o+="px",l+="px",{style:{top:o,left:l}}}function Y(t,e,n){b(n.style,{borderTopWidth:t[e+"Top"]+"px",borderLeftWidth:t[e+"Left"]+"px",borderRightWidth:t[e+"Right"]+"px",borderBottomWidth:t[e+"Bottom"]+"px",borderStyle:"solid"})}const B={background:"rgba(120, 170, 210, 0.7)",padding:"rgba(77, 200, 0, 0.3)",margin:"rgba(255, 155, 0, 0.4)",border:"rgba(255, 200, 50, 0.3)"},Ze=2e3;let A=null,S=null;function R(){A=null,S!==null&&(S.remove(),S=null)}function ie(t,e){window.document!=null&&(A!==null&&clearTimeout(A),t!=null&&(S===null&&(S=new Ke),S.inspect(t),e&&(A=setTimeout(R,Ze))))}let P=new Set;function N(t){return({data:e})=>t(e)}function et({view:t=window,onSelectNode:e=()=>{}}={}){let n=!1,r=!0,i=!0;M.onMessage("CLEAR_HIGHLIGHTS",N(g)),M.onMessage("HIGHLIGHT_ELEMENTS",N(v)),M.onMessage("SHUTDOWN",N(f)),M.onMessage("TOGGLE_INSPECTING",N(s)),M.onMessage("START_INSPECTING",N(o)),M.onMessage("STOP_INSPECTING",N(f));function s(c){n?f():o(c)}function o(c){n=!0,c&&(r=c.stopOnClick??!0,i=c.blockEvents??!0),l(t)}function l(c){c&&typeof c.addEventListener=="function"&&(c.addEventListener("click",x,!0),c.addEventListener("mousedown",E,!0),c.addEventListener("mouseover",E,!0),c.addEventListener("mouseup",E,!0),c.addEventListener("pointerdown",Q,!0),c.addEventListener("pointerover",X,!0),c.addEventListener("pointerup",K,!0),c.addEventListener("change",J,!0))}function d(c){i&&(c.preventDefault(),c.stopPropagation())}function f(){R(),y(t),P.forEach(function(c){try{y(c.contentWindow)}catch{}}),P=new Set,n=!1}function y(c){c&&typeof c.removeEventListener=="function"&&(c.removeEventListener("click",x,!0),c.removeEventListener("mousedown",E,!0),c.removeEventListener("mouseover",E,!0),c.removeEventListener("mouseup",E,!0),c.removeEventListener("pointerdown",Q,!0),c.removeEventListener("pointerover",X,!0),c.removeEventListener("pointerup",K,!0),c.removeEventListener("change",J,!0))}function g(){R()}function v({nodes:c,hideAfterTimeout:w}){if(!n)if(c!=null&&c[0]){const I=c.map(C=>typeof C=="string"?document.querySelector(C):C).filter(C=>C.nodeType===Node.ELEMENT_NODE);ie(I,w)}else R()}function x(c){d(c),n&&r&&f()}function E(c){d(c)}function Q(c){d(c),F(c.target,{origin:c.isTrusted?"click":"script"})}function X(c){d(c);const w=c.target;if(w.tagName==="IFRAME")try{if(!P.has(w)){const I=w.contentWindow;l(I),P.add(w)}}catch{}ie([w],!1),F(w,{origin:c.isTrusted?"hover":"script"})}function K(c){d(c)}function J(c){if(d(c),c.target.tagName.toLowerCase()==="select"){const w=c.target,I=w.options[w.selectedIndex];F(I,{origin:"click"})}}const F=ve(_e(e),200,{leading:!1});return{clear:g,highlight:v,stop:f,start:o}}const p={queriedNodes:[],markup:"",query:"",rootNode:null,highlighter:null,settings:{testIdAttribute:"data-testid"},pointerInside:!1};function T(t){parent.postMessage({source:"testing-playground-sandbox",...t},parent.location.origin)}function ge(t,e){const n=oe.parse({rootNode:t,query:e}),{elements:r,expression:i,formatted:s}=n,o=r.map(d=>d.cssPath).join(", ");p.queriedNodes=r.length>0?Array.from(t.querySelectorAll(o)):[],p.highlighter.highlight({nodes:p.queriedNodes});const l=Object.keys(n.accessibleRoles).reduce((d,f)=>(d[f]=!0,d),{});return{elements:r,expression:i,formatted:s,accessibleRoles:l}}function tt(t,e){const n=t.ownerDocument;t.innerHTML=e;for(let r of t.querySelectorAll("script")){const i=n.createElement("script");for(let o of r.attributes)i[o.name]=o.value;i.type=r.type||"text/javascript";const s=i.type==="text/javascript"?`(function() { ${r.innerHTML} })()`:r.innerHTML;i.appendChild(n.createTextNode(s)),r.parentNode.replaceChild(i,r)}for(let r of t.querySelectorAll("a"))r.addEventListener("click",i=>{!i.ctrlKey&&!i.shiftKey&&i.preventDefault()})}function nt(){const t=Ee.useCallback(e=>{e&&(p.rootNode=e,p.highlighter=et({view:p.rootNode,onSelectNode:it}),T({type:"SANDBOX_LOADED"}))},[]);return z.jsx("div",{className:"relative h-screen w-screen overflow-hidden pr-1",onMouseEnter:()=>{var e,n;p.pointerInside=!0,(e=p.highlighter)==null||e.clear(),(n=p.highlighter)==null||n.start({stopOnClick:!1,blockEvents:!1})},onMouseLeave:()=>{var e;(e=p.highlighter)==null||e.stop(),p.highlighter.highlight({nodes:p.queriedNodes}),p.pointerInside=!1,T({type:"HOVER_NODE",payload:null})},children:z.jsx(be,{forwardedRef:t,id:"sandbox"})})}function rt(t){const e=Object.values(t).filter(Boolean),n=Object.values(t).find(Boolean),r=e.find(i=>{var s;return(i==null?void 0:i.queryName)&&!((s=i.snippet)!=null&&s.startsWith("// sorry, I failed"))});return r||n}function it(t,{origin:e}){if(!e||e==="script"||!p.pointerInside)return;const n=Le({element:t,rootNode:p.rootNode}),r=rt(n);if(!r)return;const i={type:e==="click"?"SELECT_NODE":"HOVER_NODE",suggestion:r,cssPath:xe(t,!0).toString()};if(i.type==="SELECT_NODE"&&(p.queriedNodes=[t],p.highlighter.highlight({nodes:p.queriedNodes})),T(i),i.type==="SELECT_NODE"){p.query=i.suggestion.snippet;const s=ge(p.rootNode,p.query);T({type:"SANDBOX_READY",result:s})}}function ot(t,e,n){T({type:"SANDBOX_BUSY"}),tt(t,e);const r=ge(t,n);T({type:"SANDBOX_READY",result:r})}function st({source:t,data:e}){if(!(t!==parent||e.source!=="testing-playground")){switch(e.type){case"UPDATE_SANDBOX":{p.query=e.query,p.markup=e.markup;break}case"CONFIGURE_SANDBOX":{p.settings={...p.settings,...e.settings},oe.configure(p.settings);break}}ot(p.rootNode,p.markup,p.query)}}window.addEventListener("message",st,!1);ye.render(z.jsx(nt,{}),document.getElementById("app"));
